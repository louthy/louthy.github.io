<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>LanguageExt.Core/Concurrency/STM</title>
<link href="style.css" rel="stylesheet" type="text/css"/></head>
<body class="js-enabled"><div id="package-header"><ul class="links" id="page-menu"><li><a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Concurrency/STM" class="link">Source</a></li>
<li><a href="../index.html" class="link">Contents</a></li>
<li><a href="../../../index.html" class="link">Index</a></li></ul>
<p class="caption">LanguageExt.Core</p></div>
<div id="content"><div id="module-header"><p class="caption"><a href="../../index.html" class="link">LanguageExt.Core</a>
<span> ► </span>
<a href="../index.html" class="link">Concurrency</a>
<span> ► </span>
<a href="index.html" class="link">STM</a></p></div>

<div id="table-of-contents"><p class="caption">Contents</p>
<ul><li><a href="#_0_CommuteRef_1" class="link"><div class="nowrap">CommuteRef
<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span></div></a></li>
<ul><li><a href="#CommuteRef_1_Value_0" class="link"><div class="nowrap">Value</div></a></li>
<li><a href="#CommuteRef_1_ToString_0" class="link"><div class="nowrap">ToString

<span class='parens'>(</span><span class='parens'>)</span></div></a></li>
<li><a href="#CommuteRef_1_GetHashCode_0" class="link"><div class="nowrap">GetHashCode

<span class='parens'>(</span><span class='parens'>)</span></div></a></li>
<li><a href="#CommuteRef_1_Equals_0" class="link"><div class="nowrap">Equals

<span class='parens'>(</span>object? obj<span class='parens'>)</span></div></a></li>
<li><a href="#CommuteRef_1_Equals_0" class="link"><div class="nowrap">Equals

<span class='parens'>(</span>A other<span class='parens'>)</span></div></a></li>
<li><a href="#CommuteRef_1_Swap_0" class="link"><div class="nowrap">Swap

<span class='parens'>(</span>Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>A<span class='generics'>&gt;</span> f<span class='parens'>)</span></div></a></li>
<li><a href="#CommuteRef_1_SwapIO_0" class="link"><div class="nowrap">SwapIO

<span class='parens'>(</span>Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>A<span class='generics'>&gt;</span> f<span class='parens'>)</span></div></a></li>
<li><a href="#CommuteRef_1_Commute_0" class="link"><div class="nowrap">Commute

<span class='parens'>(</span>Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>A<span class='generics'>&gt;</span> f<span class='parens'>)</span></div></a></li></ul>
<li><a href="#_0_Isolation_0" class="link"><div class="nowrap">Isolation</div></a></li>
<ul></ul>
<li><a href="#_0_Ref_1" class="link"><div class="nowrap">Ref
<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span></div></a></li>
<ul><li><a href="#Ref_1_Value_0" class="link"><div class="nowrap">Value</div></a></li>
<li><a href="#Ref_1_ValueIO_0" class="link"><div class="nowrap">ValueIO</div></a></li>
<li><a href="#Ref_1_ToString_0" class="link"><div class="nowrap">ToString

<span class='parens'>(</span><span class='parens'>)</span></div></a></li>
<li><a href="#Ref_1_GetHashCode_0" class="link"><div class="nowrap">GetHashCode

<span class='parens'>(</span><span class='parens'>)</span></div></a></li>
<li><a href="#Ref_1_Equals_0" class="link"><div class="nowrap">Equals

<span class='parens'>(</span>object? obj<span class='parens'>)</span></div></a></li>
<li><a href="#Ref_1_Equals_0" class="link"><div class="nowrap">Equals

<span class='parens'>(</span>A? other<span class='parens'>)</span></div></a></li>
<li><a href="#Ref_1_Swap_0" class="link"><div class="nowrap">Swap

<span class='parens'>(</span>Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>A<span class='generics'>&gt;</span> f<span class='parens'>)</span></div></a></li>
<li><a href="#Ref_1_SwapIO_0" class="link"><div class="nowrap">SwapIO

<span class='parens'>(</span>Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>A<span class='generics'>&gt;</span> f<span class='parens'>)</span></div></a></li>
<li><a href="#Ref_1_Commute_0" class="link"><div class="nowrap">Commute

<span class='parens'>(</span>Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>A<span class='generics'>&gt;</span> f<span class='parens'>)</span></div></a></li></ul>
<li><a href="#_0_STM_0" class="link"><div class="nowrap">STM
</div></a></li>
<ul><li><a href="#STM_0_TransactionId_0" class="link"><div class="nowrap">TransactionId</div></a></li></ul></ul></div>
<div class="interface">
<div class="top"><p class="src"><span class="keyword">struct</span>
<a id="_0_CommuteRef_1" class="def">CommuteRef</a>
<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Concurrency/STM/CommuteRef.cs#L14" class="link">Source</a>
<a href="#_0_CommuteRef_1" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>A proxy for <code class='language-csharp'>Ref</code>, returned by <code class='language-csharp'>commute</code>.  This allows the transaction system to know that the
result is a commutative and therefore give you a result based on the live state rather than
the transaction.</p>
</div>
<div><p>See the <a href="https://github.com/louthy/language-ext/wiki/Concurrency">concurrency section</a> of the wiki for more info.</p>
</div>

</div>





<div class="subs methods"><p class="caption">Properties</p>
<div class="top"><p class="src"><span class="keyword">property</span>
A
<a id="CommuteRef_1_Value_0" class="def">Value</a>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Concurrency/STM/CommuteRef.cs#L18" class="link">Source</a>
<a href="#CommuteRef_1_Value_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div></div>
<div></div>

</div>












</div></div>

<div class="subs methods"><p class="caption">Methods</p>
<div class="top"><p class="src"><span class="keyword">method</span>
string
<a id="CommuteRef_1_ToString_0" class="def">ToString</a>

<span class='parens'>(</span><span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Concurrency/STM/CommuteRef.cs#L24" class="link">Source</a>
<a href="#CommuteRef_1_ToString_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div></div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
int
<a id="CommuteRef_1_GetHashCode_0" class="def">GetHashCode</a>

<span class='parens'>(</span><span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Concurrency/STM/CommuteRef.cs#L25" class="link">Source</a>
<a href="#CommuteRef_1_GetHashCode_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div></div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
bool
<a id="CommuteRef_1_Equals_0" class="def">Equals</a>

<span class='parens'>(</span>object? obj<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Concurrency/STM/CommuteRef.cs#L26" class="link">Source</a>
<a href="#CommuteRef_1_Equals_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div></div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
bool
<a id="CommuteRef_1_Equals_0" class="def">Equals</a>

<span class='parens'>(</span>A other<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Concurrency/STM/CommuteRef.cs#L27" class="link">Source</a>
<a href="#CommuteRef_1_Equals_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div></div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
A
<a id="CommuteRef_1_Swap_0" class="def">Swap</a>

<span class='parens'>(</span>Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>A<span class='generics'>&gt;</span> f<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Concurrency/STM/CommuteRef.cs#L28" class="link">Source</a>
<a href="#CommuteRef_1_Swap_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div></div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
IO<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<a id="CommuteRef_1_SwapIO_0" class="def">SwapIO</a>

<span class='parens'>(</span>Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>A<span class='generics'>&gt;</span> f<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Concurrency/STM/CommuteRef.cs#L29" class="link">Source</a>
<a href="#CommuteRef_1_SwapIO_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div></div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
CommuteRef<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<a id="CommuteRef_1_Commute_0" class="def">Commute</a>

<span class='parens'>(</span>Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>A<span class='generics'>&gt;</span> f<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Concurrency/STM/CommuteRef.cs#L30" class="link">Source</a>
<a href="#CommuteRef_1_Commute_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div></div>
<div></div>

</div>












</div></div>




</div>
<div class="top"><p class="src"><span class="keyword">enum</span>
<a id="_0_Isolation_0" class="def">Isolation</a>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Concurrency/STM/Isolation.cs#L10" class="link">Source</a>
<a href="#_0_Isolation_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p><code class='language-csharp'>sync</code> transaction isolation level.  Used to enforce ACI properties
of ACID on <code class='language-csharp'>Ref</code>s.</p>
</div>
<div><p>See the <a href="https://github.com/louthy/language-ext/wiki/Concurrency">concurrency section</a> of the wiki for more info.</p>
</div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">class</span>
<a id="_0_Ref_1" class="def">Ref</a>
<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Concurrency/STM/Ref.cs#L16" class="link">Source</a>
<a href="#_0_Ref_1" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Refs ensure safe shared use of mutable storage locations via a software transactional
memory (STM) system. Refs are bound to a single storage location for their lifetime, and
only allow mutation of that location to occur within a transaction.</p>
</div>
<div><p>See the <a href="https://github.com/louthy/language-ext/wiki/Concurrency">concurrency section</a> of the wiki for more info.</p>
</div>

</div>





<div class="subs methods"><p class="caption">Properties</p>
<div class="top"><p class="src"><span class="keyword">property</span>
A
<a id="Ref_1_Value_0" class="def">Value</a>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Concurrency/STM/Ref.cs#L41" class="link">Source</a>
<a href="#Ref_1_Value_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Value accessor (read and write)</p>
</div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">property</span>
IO<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<a id="Ref_1_ValueIO_0" class="def">ValueIO</a>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Concurrency/STM/Ref.cs#L59" class="link">Source</a>
<a href="#Ref_1_ValueIO_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Value accessor (read and write)</p>
</div>
<div><ul>
<li class='markdown-bullet'><p>Gets will return a freshly constructed <code class='language-csharp'>IO</code> monad that can be repeatedly
evaluated to get the latest state of the <code class='language-csharp'>Ref</code>.</p>
</li>
<li class='markdown-bullet'><p>Sets pass an <code class='language-csharp'>IO</code> monad that will be mapped to an operation that will set
the value of the <code class='language-csharp'>Ref</code> each time it's evaluated.</p>
</li>
</ul>
</div>

</div>












</div></div>

<div class="subs methods"><p class="caption">Methods</p>
<div class="top"><p class="src"><span class="keyword">method</span>
string
<a id="Ref_1_ToString_0" class="def">ToString</a>

<span class='parens'>(</span><span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Concurrency/STM/Ref.cs#L79" class="link">Source</a>
<a href="#Ref_1_ToString_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>ToString for the bound value</p>
</div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
int
<a id="Ref_1_GetHashCode_0" class="def">GetHashCode</a>

<span class='parens'>(</span><span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Concurrency/STM/Ref.cs#L85" class="link">Source</a>
<a href="#Ref_1_GetHashCode_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Hash code of the bound value</p>
</div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
bool
<a id="Ref_1_Equals_0" class="def">Equals</a>

<span class='parens'>(</span>object? obj<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Concurrency/STM/Ref.cs#L91" class="link">Source</a>
<a href="#Ref_1_Equals_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Equality</p>
</div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
bool
<a id="Ref_1_Equals_0" class="def">Equals</a>

<span class='parens'>(</span>A? other<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Concurrency/STM/Ref.cs#L97" class="link">Source</a>
<a href="#Ref_1_Equals_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Equality</p>
</div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
A
<a id="Ref_1_Swap_0" class="def">Swap</a>

<span class='parens'>(</span>Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>A<span class='generics'>&gt;</span> f<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Concurrency/STM/Ref.cs#L106" class="link">Source</a>
<a href="#Ref_1_Swap_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Swap the old value for the new returned by <code class='language-csharp'>f</code>
Must be run within a <code class='language-csharp'>sync</code> transaction</p>
</div>
<div></div>
<div class="methods"><p class="caption">Parameters</p>
<div class="params-and-returns"><table><tbody><tr><td class="src clearfix"><span class="keyword">param</span></td>
<td class="src clearfix"><span class="inst-left"><span class="def">f</span></span></td>
<td class="src clearfix"><span class="instruction inst-left"><p>Swap function</p>
</span></td></tr>
<tr><td class="src clearfix"><span class="keyword">returns</span></td>
<td colspan="2" class="src clearfix"><span class="instruction inst-left"><p>The value returned from <code class='language-csharp'>f</code></p>
</span></td></tr></tbody></table></div></div>
</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
IO<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<a id="Ref_1_SwapIO_0" class="def">SwapIO</a>

<span class='parens'>(</span>Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>A<span class='generics'>&gt;</span> f<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Concurrency/STM/Ref.cs#L119" class="link">Source</a>
<a href="#Ref_1_SwapIO_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Swap the old value for the new returned by <code class='language-csharp'>f</code>
Must be run within a <code class='language-csharp'>sync</code> transaction</p>
</div>
<div></div>
<div class="methods"><p class="caption">Parameters</p>
<div class="params-and-returns"><table><tbody><tr><td class="src clearfix"><span class="keyword">param</span></td>
<td class="src clearfix"><span class="inst-left"><span class="def">f</span></span></td>
<td class="src clearfix"><span class="instruction inst-left"><p>Swap function</p>
</span></td></tr>
<tr><td class="src clearfix"><span class="keyword">returns</span></td>
<td colspan="2" class="src clearfix"><span class="instruction inst-left"><p>The value returned from <code class='language-csharp'>f</code></p>
</span></td></tr></tbody></table></div></div>
</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
CommuteRef<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<a id="Ref_1_Commute_0" class="def">Commute</a>

<span class='parens'>(</span>Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>A<span class='generics'>&gt;</span> f<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Concurrency/STM/Ref.cs#L145" class="link">Source</a>
<a href="#Ref_1_Commute_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Must be called in a transaction. Sets the in-transaction-value of
ref to:</p>
<pre class='language-csharp'><code class='language-csharp'>`f(in-transaction-value-of-ref)`
</code></pre>
<p>and returns the in-transaction-value when complete.</p>
<p>At the commit point of the transaction, <code class='language-csharp'>f</code> is run <em>AGAIN</em> with the
most recently committed value:</p>
<pre class='language-csharp'><code class='language-csharp'>`f(most-recently-committed-value-of-ref)`
</code></pre>
<p>Thus <code class='language-csharp'>f</code> should be commutative, or, failing that, you must accept
last-one-in-wins behavior.</p>
<p>Commute allows for more concurrency than just setting the Ref's value</p>
</div>
<div></div>

</div>












</div></div>




</div>
<div class="top"><p class="src"><span class="keyword">class</span>
<a id="_0_STM_0" class="def">STM</a>

<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Concurrency/STM/STM.cs#L17" class="link">Source</a>
<a href="#_0_STM_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Software transactional memory using Multi-Version Concurrency Control (MVCC)</p>
</div>
<div><p>See the <a href="https://github.com/louthy/language-ext/wiki/Concurrency">concurrency section</a> of the wiki for more info.</p>
</div>

</div>





<div class="subs methods"><p class="caption">Properties</p>
<div class="top"><p class="src"><span class="keyword">property</span>
long
<a id="STM_0_TransactionId_0" class="def">TransactionId</a>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Concurrency/STM/STM.cs#L502" class="link">Source</a>
<a href="#STM_0_TransactionId_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Get the currently running TransactionId</p>
</div>
<div></div>

</div>












</div></div>






</div></div></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-core.min.js" integrity="sha512-9khQRAUBYEJDCDVP2yw3LRUQvjJ0Pjx0EShmaQjcHa6AXiOv6qHQu9lCAIR8O+/D8FtaCoJ2c0Tf9Xo7hYH01Q==" crossorigin="anonymous" referrerpolicy="no-referrer"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/autoloader/prism-autoloader.min.js" integrity="sha512-fTl/qcO1VgvKtOMApX2PdZzkziyr2stM65GYPLGuYMnuMm1z2JLJG6XVU7C/mR+E7xBUqCivykuhlzfqxXBXbg==" crossorigin="anonymous" referrerpolicy="no-referrer"/></body></html>