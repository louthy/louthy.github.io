<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>LanguageExt.Core/Immutable Collections/IteratorAsync</title>
<link href="style.css" rel="stylesheet" type="text/css"/></head>
<body class="js-enabled"><div id="package-header"><ul class="links" id="page-menu"><li><a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync" class="link">Source</a></li>
<li><a href="../index.html" class="link">Contents</a></li>
<li><a href="../../../index.html" class="link">Index</a></li></ul>
<p class="caption">LanguageExt.Core</p></div>
<div id="content"><div id="module-header"><p class="caption"><a href="../../index.html" class="link">LanguageExt.Core</a>
<span> ► </span>
<a href="../index.html" class="link">Immutable Collections</a>
<span> ► </span>
<a href="index.html" class="link">IteratorAsync</a></p></div>
<p><code>Iterator&lt;A&gt;</code> is a functional-wrapper for <code>IEnumerator&lt;A&gt;</code>.  The abstraction leaks a little, so it's worth
understanding how it works by reading the details below.  On the whole it behaves like an immutable stream
that caches values as it goes, but there's some footguns that you should be aware of so that they can be
avoided.</p>
<h2>Problem: <code>IEnumerator&lt;A&gt;</code></h2>
<ul>
<li class='markdown-bullet'>It is mutable which means using it in immutable data-structures is problematic.</li>
<li class='markdown-bullet'>If you pass an <code>IEnumerator</code> reference to two threads, each thread can
call <code>MoveNext</code>and it will move the enumeration position for other thread, or even worse, move past the end
of the sequence due to race conditions.</li>
<li class='markdown-bullet'>Enumerators start before the first item and use a complicated mechanism for accessing and testing the validity of
the element value.</li>
</ul>
<p><em>Nobody in their right mind would invent an interface like <code>IEnumerator&lt;A&gt;</code> today.</em></p>
<h2>Solution: <code>Iterator&lt;A&gt;</code></h2>
<p><code>Iterator&lt;A&gt;</code> still uses <code>IEnumerator&lt;A&gt;</code> internally, but it makes it thread-safe and functional.  From the outside
the type acts and works exactly like any other immutable sequence, but internally it does some quite complex
processing to achieve this with an <code>IEnumerator&lt;A&gt;</code> reference.</p>
<blockquote>
<p>You may say &quot;Why not just drop <code>IEnumerator&lt;A&gt;</code>?&quot; - which is a completely valid position to hold. Unfortunately,
<code>IEnumerable</code> and <code>IEnumerator</code> are baked into the CPS state-machine that is used for <code>yield return</code> and
<code>yield break</code>.  So, we don't get to ignore those types, and instead we need to make them play nice.</p>
</blockquote>
<p><code>IEnumerable&lt;A&gt;</code> has a method called <code>GetEnumerator()</code> which is used to access an <code>IEnumerator&lt;A&gt;</code>.  A new extension
method is available called <code>GetIterator()</code>, this will yield an <code>Iterator&lt;A&gt;</code>.</p>
<p>You can pattern-match an <code>Iterator&lt;A&gt;</code> like a functional 'cons' linked-list type:</p>
<pre class='language-csharp'><code class="language-c#">static A Sum&lt;A&gt;(Iterator&lt;A&gt; iter) where A : INumber =&gt;
    iter switch
    {
        Iterator&lt;A&gt;.Nil                 =&gt; A.Zero,
        Iterator&lt;A&gt;.Cons(var x, var xs) =&gt; x + Sum(xs),
    }
</code></pre>
<p>Or, use <code>IsEmpty</code> and <code>Head</code>:</p>
<pre class='language-csharp'><code class="language-c#">static A Sum&lt;A&gt;(Iterator&lt;A&gt; iter) where A : INumber =&gt;
    iter.IsEmpty
        ? A.Zero
        : iter.Head + Sum(iter.Tail);
</code></pre>
<p>Or, use built-in operators:</p>
<pre class='language-csharp'><code class="language-c#">static A Sum&lt;A&gt;(Iterator&lt;A&gt; iter) where A : INumber =&gt;
    iter.Fold(A.Zero, (s, x) =&gt; s + x);
</code></pre>
<p>Or, take an imperative approach:</p>
<pre class='language-csharp'><code class="language-c#">static A Sum&lt;A&gt;(Iterator&lt;A&gt; iter) where A : INumber
{
    var total = A.Zero;
    while(!iter.IsEmpty)
    {
        total += iter.Head;
        iter = iter.Tail;
    }
    return total;
}
</code></pre>
<p><code>Iterator&lt;A&gt;</code> is <code>abstract</code> and the first type returned from <code>GetIterator()</code> will be a <code>Iterator&lt;A&gt;.ConsFirst</code>, this type implements
<code>Iterator&lt;A&gt;</code>.  The internal fields that <code>ConsFirst</code> contains are these:</p>
<pre class='language-csharp'><code class="language-c#">IEnumerable&lt;A&gt; enumerable;
int firstAcquired;
Iterator&lt;A&gt;? firstValue;
</code></pre>
<p>So, you can see that it doesn't actually have an <code>IEnumerator&lt;A&gt;</code> as this point.</p>
<p>The two key properties of <code>Iterator&lt;A&gt;</code> are <code>Head</code> (for accessing the current item) and <code>Tail</code> (for accessing
the remaining items), so let's look at those for <code>ConsFirst</code>:</p>
<pre class='language-csharp'><code class="language-c#">public override A Head =&gt;
    First.Head;

public override Iterator&lt;A&gt; Tail =&gt;
    First.Tail;
</code></pre>
<p>They both access <code>First</code>, which is:</p>
<pre class='language-csharp'><code class="language-c#">Iterator&lt;A&gt; First
{
    get
    {
        if (firstAcquired == 2) return firstValue!;
        
        SpinWait sw = default;
        while (firstAcquired &lt; 2)
        {
            if (Interlocked.CompareExchange(ref firstAcquired, 1, 0) == 0)
            {
                try
                {
                    var enumerator = enumerable.GetEnumerator();
                    if (enumerator.MoveNext())
                    {
                        firstValue = new ConsValueEnum(enumerator.Current, enumerator);
                    }
                    else
                    {
                        enumerator.Dispose();
                        firstValue = Nil.Default;
                    }

                    firstAcquired = 2;
                }
                catch (Exception)
                {
                    firstAcquired = 0;
                    throw;
                }
            }
            else
            {
                sw.SpinOnce();
            }
        }

        return firstValue!;
    }
}
</code></pre>
<p>This all looks quite complex, but you should be able to see that the <code>Interlocked.CompareExchange</code>
then-block is where the <code>IEnumerator</code> is created.  We then either set <code>firstValue</code> to a new <code>ConsValueEnum</code> with
the head-item and the <code>enumerator</code> as arguments; or we set it to <code>Nil</code>.</p>
<p>Upon success we set <code>firstAcquired</code> to <code>2</code>.  So, subsequent calls to <code>First</code> will just return <code>firstValue</code>.  This
locking technique without using locks is a way to efficiently protect the enumerator from race-conditions.</p>
<p>So, upon first access to either <code>Head</code> or <code>Tail</code> we launch the <code>IEnumerator</code> and cache the first item in the sequence.
All subsequent access goes to <code>Head</code> or <code>Tail</code> on either <code>Nil</code> or <code>ConsValueEnum</code>.  We never touch the <code>IEnumerator</code>
again in <code>ConsFirst</code>.</p>
<p>The <code>Nil</code> implementation isn't so surprising:</p>
<pre class='language-csharp'><code class="language-c#">public override A Head =&gt;
    throw new InvalidOperationException(&quot;Nil iterator has no head&quot;);

public override Iterator&lt;A&gt; Tail =&gt;
    this;
</code></pre>
<p><code>ConsValueEnum</code> is where it gets interesting.  It has the following internal fields:</p>
<pre class='language-csharp'><code class="language-c#">Exception? exception;
IEnumerator&lt;A&gt;? enumerator;
int tailAcquired;
Iterator&lt;A&gt;? tailValue;
</code></pre>
<p>It also has a <code>Head</code> property that is set in the constructor:</p>
<pre class='language-csharp'><code class="language-c#">public override A Head { get; }
</code></pre>
<p>So, we can access the <code>Head</code> value at any time, but the <code>Tail</code> value isn't yet set:</p>
<pre class='language-csharp'><code class="language-c#">public override Iterator&lt;A&gt; Tail
{
    get
    {
        if(tailAcquired == 2) return tailValue!;
        if(tailAcquired == 3) exception!.Rethrow();

        SpinWait sw = default;
        while (tailAcquired &lt; 2)
        {
            if (Interlocked.CompareExchange(ref tailAcquired, 1, 0) == 0)
            {   
                try
                {
                    if (enumerator!.MoveNext())
                    {
                        tailValue = new ConsValueEnum(enumerator.Current, enumerator);
                    }
                    else
                    {
                        enumerator?.Dispose();
                        enumerator = null;
                        tailValue = Nil.Default;
                    }

                    tailAcquired = 2;
                }
                catch (Exception e)
                {
                    exception = e;
                    tailAcquired = 3;
                    throw;
                }
            }
            else
            {
                sw.SpinOnce();
            }
        }

        if(tailAcquired == 3) exception!.Rethrow();
        return tailValue!;
    }
}
</code></pre>
<p>This does a similar thing to <code>ConsFirst</code> of protecting a section with <code>Interlocked.CompareExchange</code>.  So, we can
only ever access the 'then' part [of that <code>if</code> statement] once.  In that block we <code>MoveNext</code> the <code>IEnumerator</code>
which will either return <code>true</code> or <code>false</code>.</p>
<p>If <code>true</code> then we create another <code>ConsValueEnum</code>, if <code>false</code> then we use <code>Nil</code>.  Whichever is created gets assigned
to <code>tailValue</code> and <code>tailAcquired</code> gets set to <code>2</code>.  That means subsequent calls to <code>Tail</code> will just return
<code>tailValue</code>.</p>
<p>That process continues for each item of the sequence until the <code>IEnumerator</code> runs out of items to yield.  The end
result is a linked-list of <code>ConsValueEnum</code> objects that have a <code>ConsFirst</code> object at the head of the linked-list.</p>
<p>So, <code>Iterator&lt;A&gt;</code> effectively caches the sequence as you go.  If you hold on to the head of the sequence then the
whole list may end up in memory at once.  This could be problematic when working with large lazy sequences or even
infinite sequences.</p>
<p>This for example is fine:</p>
<pre class='language-csharp'><code class="language-c#">for(var iter = Naturals.GetIterator(); !iter.IsEmpty; iter = iter.Tail)
{
    Console.WriteLine(iter.Head);
}
</code></pre>
<p>Because the <code>iter</code> reference keeps getting updated in-place, meaning that nothing is holding on to the head-item in
the sequence, and so the garbage-collector can collect those unreferenced items.</p>
<p>Whereas this will cause memory-usage to grow and grow:</p>
<pre class='language-csharp'><code class="language-c#">var start = Naturals.GetIterator();
for(var iter = start; !iter.IsEmpty; iter = iter.Tail)
{
    Console.WriteLine(iter.Head);
}
</code></pre>
<p>Because <code>start</code> is holding a reference to the first item, so it must hold a reference (indirectly) to every
subsequent item.  Meaning the garbage-collector can't collect.</p>
<p>To get around this you can use <code>Clone</code>:</p>
<pre class='language-csharp'><code class="language-c#">var start = Naturals.GetIterator();
for(var iter = start.Clone(); !iter.IsEmpty; iter = iter.Tail)
{
    Console.WriteLine(iter.Head);
}
</code></pre>
<p>This creates a new 'head' for the sequence and so <code>iter</code> is the only reference, meaning updates to <code>iter</code>
make the head elements free for garbage collection.</p>
<p>So, <code>Iterator&lt;A&gt;</code> is much, much more powerful than <code>IEnumerator&lt;A&gt;</code>.  It is mostly useful for immutable data-types
that need to carry an <code>IEnumerator&lt;A&gt;</code>, but can't due it its limitations.  <code>Iterator&lt;A&gt;</code> has some limitations of its
own, but they are relatively easy to workaround, whereas that isn't the case with <code>IEnumerator&lt;A&gt;</code> (without writing
a type like <code>Iterator&lt;A&gt;</code>!).</p>

<div id="table-of-contents"><p class="caption">Contents</p>
<ul><li><a href="#_0_IteratorAsync_1" class="link"><div class="nowrap">IteratorAsync
<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span></div></a></li>
<ul><li><a href="#IteratorAsync_1_Empty = new Nil()_0" class="link"><div class="nowrap">Empty = new Nil()</div></a></li>
<li><a href="#IteratorAsync_1_Head_0" class="link"><div class="nowrap">Head</div></a></li>
<li><a href="#IteratorAsync_1_Tail_0" class="link"><div class="nowrap">Tail</div></a></li>
<li><a href="#IteratorAsync_1_IsEmpty_0" class="link"><div class="nowrap">IsEmpty</div></a></li>
<li><a href="#IteratorAsync_1_Count_0" class="link"><div class="nowrap">Count</div></a></li>
<li><a href="#IteratorAsync_1_Clone_0" class="link"><div class="nowrap">Clone

<span class='parens'>(</span><span class='parens'>)</span></div></a></li>
<li><a href="#IteratorAsync_1_Split_0" class="link"><div class="nowrap">Split

<span class='parens'>(</span><span class='parens'>)</span></div></a></li>
<li><a href="#IteratorAsync_1_AsEnumerable_0" class="link"><div class="nowrap">AsEnumerable

<span class='parens'>(</span>[EnumeratorCancellation] CancellationToken token<span class='parens'>)</span></div></a></li>
<li><a href="#IteratorAsync_1_Select_1" class="link"><div class="nowrap">Select
<span class='generics'>&lt;</span>B<span class='generics'>&gt;</span>
<span class='parens'>(</span>Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>B<span class='generics'>&gt;</span> f<span class='parens'>)</span></div></a></li>
<li><a href="#IteratorAsync_1_Map_1" class="link"><div class="nowrap">Map
<span class='generics'>&lt;</span>B<span class='generics'>&gt;</span>
<span class='parens'>(</span>Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>B<span class='generics'>&gt;</span> f<span class='parens'>)</span></div></a></li>
<li><a href="#IteratorAsync_1_Bind_1" class="link"><div class="nowrap">Bind
<span class='generics'>&lt;</span>B<span class='generics'>&gt;</span>
<span class='parens'>(</span>Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>IteratorAsync<span class='generics'>&lt;</span>B<span class='generics'>&gt;</span><span class='generics'>&gt;</span> f<span class='parens'>)</span></div></a></li>
<li><a href="#IteratorAsync_1_SelectMany_2" class="link"><div class="nowrap">SelectMany
<span class='generics'>&lt;</span>B<span class='comma'>, </span>C<span class='generics'>&gt;</span>
<span class='parens'>(</span>Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>IteratorAsync<span class='generics'>&lt;</span>B<span class='generics'>&gt;</span><span class='generics'>&gt;</span> bind<span class='comma'>, </span>Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>B<span class='comma'>, </span>C<span class='generics'>&gt;</span> project<span class='parens'>)</span></div></a></li>
<li><a href="#IteratorAsync_1_Apply_1" class="link"><div class="nowrap">Apply
<span class='generics'>&lt;</span>B<span class='generics'>&gt;</span>
<span class='parens'>(</span>IteratorAsync<span class='generics'>&lt;</span>Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>B<span class='generics'>&gt;</span><span class='generics'>&gt;</span> ff<span class='comma'>, </span>IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span> fa<span class='parens'>)</span></div></a></li>
<li><a href="#IteratorAsync_1_Concat_0" class="link"><div class="nowrap">Concat

<span class='parens'>(</span>IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span> other<span class='parens'>)</span></div></a></li>
<li><a href="#IteratorAsync_1_Fold_1" class="link"><div class="nowrap">Fold
<span class='generics'>&lt;</span>S<span class='generics'>&gt;</span>
<span class='parens'>(</span>
        S state,
        Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>Func<span class='generics'>&lt;</span>S<span class='comma'>, </span>S<span class='generics'>&gt;</span><span class='generics'>&gt;</span> f<span class='parens'>)</span></div></a></li>
<li><a href="#IteratorAsync_1_Fold_1" class="link"><div class="nowrap">Fold
<span class='generics'>&lt;</span>S<span class='generics'>&gt;</span>
<span class='parens'>(</span>        
        S state,
        Func<span class='generics'>&lt;</span>S<span class='comma'>, </span>A<span class='comma'>, </span>S<span class='generics'>&gt;</span> f<span class='parens'>)</span></div></a></li>
<li><a href="#IteratorAsync_1_FoldWhile_1" class="link"><div class="nowrap">FoldWhile
<span class='generics'>&lt;</span>S<span class='generics'>&gt;</span>
<span class='parens'>(</span>
        S state,
        Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>Func<span class='generics'>&lt;</span>S<span class='comma'>, </span>S<span class='generics'>&gt;</span><span class='generics'>&gt;</span> f,
        Func<span class='generics'>&lt;</span><span class='parens'>(</span>S State<span class='comma'>, </span>A Value<span class='parens'>)</span><span class='comma'>, </span>bool<span class='generics'>&gt;</span> predicate<span class='parens'>)</span></div></a></li>
<li><a href="#IteratorAsync_1_FoldWhile_1" class="link"><div class="nowrap">FoldWhile
<span class='generics'>&lt;</span>S<span class='generics'>&gt;</span>
<span class='parens'>(</span>
        S state,
        Func<span class='generics'>&lt;</span>S<span class='comma'>, </span>A<span class='comma'>, </span>S<span class='generics'>&gt;</span> f,
        Func<span class='generics'>&lt;</span><span class='parens'>(</span>S State<span class='comma'>, </span>A Value<span class='parens'>)</span><span class='comma'>, </span>bool<span class='generics'>&gt;</span> predicate<span class='parens'>)</span></div></a></li>
<li><a href="#IteratorAsync_1_FoldUntil_1" class="link"><div class="nowrap">FoldUntil
<span class='generics'>&lt;</span>S<span class='generics'>&gt;</span>
<span class='parens'>(</span>
        S state,
        Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>Func<span class='generics'>&lt;</span>S<span class='comma'>, </span>S<span class='generics'>&gt;</span><span class='generics'>&gt;</span> f,
        Func<span class='generics'>&lt;</span><span class='parens'>(</span>S State<span class='comma'>, </span>A Value<span class='parens'>)</span><span class='comma'>, </span>bool<span class='generics'>&gt;</span> predicate<span class='parens'>)</span></div></a></li>
<li><a href="#IteratorAsync_1_FoldUntil_1" class="link"><div class="nowrap">FoldUntil
<span class='generics'>&lt;</span>S<span class='generics'>&gt;</span>
<span class='parens'>(</span>
        S state,
        Func<span class='generics'>&lt;</span>S<span class='comma'>, </span>A<span class='comma'>, </span>S<span class='generics'>&gt;</span> f,
        Func<span class='generics'>&lt;</span><span class='parens'>(</span>S State<span class='comma'>, </span>A Value<span class='parens'>)</span><span class='comma'>, </span>bool<span class='generics'>&gt;</span> predicate<span class='parens'>)</span></div></a></li>
<li><a href="#IteratorAsync_1_Merge_0" class="link"><div class="nowrap">Merge

<span class='parens'>(</span>IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span> other<span class='parens'>)</span></div></a></li>
<li><a href="#IteratorAsync_1_Zip_0" class="link"><div class="nowrap">Zip

<span class='parens'>(</span>IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span> other<span class='parens'>)</span></div></a></li>
<li><a href="#IteratorAsync_1_+_0" class="link"><div class="nowrap">+
<span class='parens'>(</span>IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span> ma<span class='comma'>, </span>IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span> mb<span class='parens'>)</span></div></a></li>
<li><a href="#IteratorAsync_1_DisposeAsync_0" class="link"><div class="nowrap">DisposeAsync

<span class='parens'>(</span><span class='parens'>)</span></div></a></li>
<li><a href="#IteratorAsync_1_GetAsyncEnumerator_0" class="link"><div class="nowrap">GetAsyncEnumerator

<span class='parens'>(</span>CancellationToken token<span class='parens'>)</span></div></a></li>
<li><a href="#IteratorAsync_1_ToString_0" class="link"><div class="nowrap">ToString

<span class='parens'>(</span><span class='parens'>)</span></div></a></li></ul>
<li><a href="#IteratorAsync_1_Nil_0" class="link"><div class="nowrap">Nil
</div></a></li>
<ul><li><a href="#Nil_0_Default = new Nil()_0" class="link"><div class="nowrap">Default = new Nil()</div></a></li>
<li><a href="#Nil_0_Head_0" class="link"><div class="nowrap">Head</div></a></li>
<li><a href="#Nil_0_Tail_0" class="link"><div class="nowrap">Tail</div></a></li>
<li><a href="#Nil_0_IsEmpty_0" class="link"><div class="nowrap">IsEmpty</div></a></li>
<li><a href="#Nil_0_Clone_0" class="link"><div class="nowrap">Clone

<span class='parens'>(</span><span class='parens'>)</span></div></a></li>
<li><a href="#Nil_0_Split_0" class="link"><div class="nowrap">Split

<span class='parens'>(</span><span class='parens'>)</span></div></a></li>
<li><a href="#Nil_0_Count_0" class="link"><div class="nowrap">Count</div></a></li>
<li><a href="#Nil_0_DisposeAsync_0" class="link"><div class="nowrap">DisposeAsync

<span class='parens'>(</span><span class='parens'>)</span></div></a></li></ul>
<li><a href="#IteratorAsync_1_Cons_0" class="link"><div class="nowrap">Cons
</div></a></li>
<ul><li><a href="#Cons_0_Deconstruct_0" class="link"><div class="nowrap">Deconstruct

<span class='parens'>(</span>out ValueTask<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span> head<span class='comma'>, </span>out ValueTask<span class='generics'>&lt;</span>IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span><span class='generics'>&gt;</span> tail<span class='parens'>)</span></div></a></li></ul>
<li><a href="#_0_IteratorAsyncExtensions_0" class="link"><div class="nowrap">IteratorAsyncExtensions
</div></a></li>
<ul><li><a href="#IteratorAsyncExtensions_0_As_1" class="link"><div class="nowrap">As
<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<span class='parens'>(</span>this K<span class='generics'>&lt;</span>IteratorAsync<span class='comma'>, </span>A<span class='generics'>&gt;</span> ma<span class='parens'>)</span></div></a></li>
<li><a href="#IteratorAsyncExtensions_0_GetIteratorAsync_1" class="link"><div class="nowrap">GetIteratorAsync
<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<span class='parens'>(</span>this IAsyncEnumerable<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span> enumerable<span class='parens'>)</span></div></a></li></ul>
<li><a href="#_0_IteratorAsync_0" class="link"><div class="nowrap">IteratorAsync
</div></a></li>
<ul><li><a href="#IteratorAsync_0_from_1" class="link"><div class="nowrap">from
<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<span class='parens'>(</span>IAsyncEnumerable<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span> enumerable<span class='parens'>)</span></div></a></li>
<li><a href="#IteratorAsync_0_singleton_1" class="link"><div class="nowrap">singleton
<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<span class='parens'>(</span>A head<span class='parens'>)</span></div></a></li>
<li><a href="#IteratorAsync_0_Cons_1" class="link"><div class="nowrap">Cons
<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<span class='parens'>(</span>A head<span class='comma'>, </span>IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span> tail<span class='parens'>)</span></div></a></li>
<li><a href="#IteratorAsync_0_Cons_1" class="link"><div class="nowrap">Cons
<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<span class='parens'>(</span>A head<span class='comma'>, </span>Func<span class='generics'>&lt;</span>IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span><span class='generics'>&gt;</span> tail<span class='parens'>)</span></div></a></li>
<li><a href="#IteratorAsync_0_Nil_1" class="link"><div class="nowrap">Nil
<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<span class='parens'>(</span><span class='parens'>)</span></div></a></li></ul>
<li><a href="#_0_IteratorAsync_0" class="link"><div class="nowrap">IteratorAsync
</div></a></li>
<ul></ul></ul></div>
<div class="interface">
<div class="top"><p class="src"><span class="keyword">class</span>
<a id="_0_IteratorAsync_1" class="def">IteratorAsync</a>
<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L39" class="link">Source</a>
<a href="#_0_IteratorAsync_1" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Wrapper for <code>IEnumerator</code> that makes it work like an immutable sequence.</p>
<p>It is thread-safe and impossible for any item in the sequence to be enumerated more than once.</p>
</div>
<div><p><code>IEnumerator</code> from the .NET BCL has several problems:</p>
<ul>
<li class='markdown-bullet'>It's very imperative</li>
<li class='markdown-bullet'>It's not thread-safe, two enumerators can't be shared</li>
</ul>
<p>The lack of support for sharing of enumerators means that it's problematic using it internally
in types like <code>StreamT</code>, or anything that needs to keep an <code>IEnumerator</code> alive for any period
of time.</p>
<p>NOTE: There is a per-item allocation to hold the state of the iterator.  These are discarded as
you enumerate the sequence.  However, technically it is possible to hold the initial <code>Iterator</code>
value and subsequently gain a cached sequence of every item encountered in the enumerator.</p>
<p>That may well be valuable for circumstances where re-evaluation would be expensive.  However,
for infinite-streams this would be extremely problematic.  So, make sure you discard any
previous <code>IteratorAsync</code> values as you walk the sequence.</p>
</div>
<div class="methods"><p class="caption">Parameters</p>
<div class="params-and-returns"><table><tbody><tr><td class="src clearfix"><span class="keyword">type</span></td>
<td class="src clearfix"><span class="inst-left"><span class="def">A</span></span></td>
<td class="src clearfix"><span class="instruction inst-left"><p>Item value type</p>
</span></td></tr></tbody></table></div></div>
</div>



<div class="subs methods"><p class="caption">Fields</p>
<div class="top"><p class="src"><span class="keyword">field</span>
IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<a id="IteratorAsync_1_Empty = new Nil()_0" class="def">Empty = new Nil()</a>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L47" class="link">Source</a>
<a href="#IteratorAsync_1_Empty = new Nil()_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Empty iterator</p>
</div>
<div></div>

</div>












</div></div>

<div class="subs methods"><p class="caption">Properties</p>
<div class="top"><p class="src"><span class="keyword">property</span>
ValueTask<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<a id="IteratorAsync_1_Head_0" class="def">Head</a>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L52" class="link">Source</a>
<a href="#IteratorAsync_1_Head_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Head element</p>
</div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">property</span>
ValueTask<span class='generics'>&lt;</span>IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span><span class='generics'>&gt;</span>
<a id="IteratorAsync_1_Tail_0" class="def">Tail</a>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L58" class="link">Source</a>
<a href="#IteratorAsync_1_Tail_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Tail of the sequence</p>
</div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">property</span>
ValueTask<span class='generics'>&lt;</span>bool<span class='generics'>&gt;</span>
<a id="IteratorAsync_1_IsEmpty_0" class="def">IsEmpty</a>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L64" class="link">Source</a>
<a href="#IteratorAsync_1_IsEmpty_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Return true if there are no elements in the sequence.</p>
</div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">property</span>
ValueTask<span class='generics'>&lt;</span>long<span class='generics'>&gt;</span>
<a id="IteratorAsync_1_Count_0" class="def">Count</a>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L73" class="link">Source</a>
<a href="#IteratorAsync_1_Count_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Return the number of items in the sequence.</p>
</div>
<div><p>Requires all items to be evaluated, this will happen only once however.</p>
</div>

</div>












</div></div>

<div class="subs methods"><p class="caption">Methods</p>
<div class="top"><p class="src"><span class="keyword">method</span>
IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<a id="IteratorAsync_1_Clone_0" class="def">Clone</a>

<span class='parens'>(</span><span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L80" class="link">Source</a>
<a href="#IteratorAsync_1_Clone_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Clone the iterator so that we can consume it without having the head item referenced.
This will stop any GC pressure when processing large or infinite sequences.</p>
</div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<a id="IteratorAsync_1_Split_0" class="def">Split</a>

<span class='parens'>(</span><span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L94" class="link">Source</a>
<a href="#IteratorAsync_1_Split_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>When iterating a sequence, it is possible (before evaluation of the <code>Tail</code>) to Terminate the current
iterator and to take a new iterator that continues on from the current location.  The reasons for doing
this are to break the linked-list chain so that there isn't a big linked-list of objects in memory that
can't be garbage collected.</p>
</div>
<div><p>Any other iterator references that came before this one will terminate at this point.  Splitting the
previous and subsequent iterators here.</p>
</div>
<div class="methods"><p class="caption">Parameters</p>
<div class="params-and-returns"><table><tbody><tr><td class="src clearfix"><span class="keyword">returns</span></td>
<td colspan="2" class="src clearfix"><span class="instruction inst-left"><p>New iterator that starts from the current iterator position.</p>
</span></td></tr></tbody></table></div></div>
</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
IAsyncEnumerable<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<a id="IteratorAsync_1_AsEnumerable_0" class="def">AsEnumerable</a>

<span class='parens'>(</span>[EnumeratorCancellation] CancellationToken token<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L99" class="link">Source</a>
<a href="#IteratorAsync_1_AsEnumerable_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Create an <code>IEnumerable</code> from an <code>Iterator</code></p>
</div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
IteratorAsync<span class='generics'>&lt;</span>B<span class='generics'>&gt;</span>
<a id="IteratorAsync_1_Select_1" class="def">Select</a>
<span class='generics'>&lt;</span>B<span class='generics'>&gt;</span>
<span class='parens'>(</span>Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>B<span class='generics'>&gt;</span> f<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L112" class="link">Source</a>
<a href="#IteratorAsync_1_Select_1" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Functor map</p>
</div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
IteratorAsync<span class='generics'>&lt;</span>B<span class='generics'>&gt;</span>
<a id="IteratorAsync_1_Map_1" class="def">Map</a>
<span class='generics'>&lt;</span>B<span class='generics'>&gt;</span>
<span class='parens'>(</span>Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>B<span class='generics'>&gt;</span> f<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L119" class="link">Source</a>
<a href="#IteratorAsync_1_Map_1" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Functor map</p>
</div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
IteratorAsync<span class='generics'>&lt;</span>B<span class='generics'>&gt;</span>
<a id="IteratorAsync_1_Bind_1" class="def">Bind</a>
<span class='generics'>&lt;</span>B<span class='generics'>&gt;</span>
<span class='parens'>(</span>Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>IteratorAsync<span class='generics'>&lt;</span>B<span class='generics'>&gt;</span><span class='generics'>&gt;</span> f<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L135" class="link">Source</a>
<a href="#IteratorAsync_1_Bind_1" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Monad bind</p>
</div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
IteratorAsync<span class='generics'>&lt;</span>C<span class='generics'>&gt;</span>
<a id="IteratorAsync_1_SelectMany_2" class="def">SelectMany</a>
<span class='generics'>&lt;</span>B<span class='comma'>, </span>C<span class='generics'>&gt;</span>
<span class='parens'>(</span>Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>IteratorAsync<span class='generics'>&lt;</span>B<span class='generics'>&gt;</span><span class='generics'>&gt;</span> bind<span class='comma'>, </span>Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>B<span class='comma'>, </span>C<span class='generics'>&gt;</span> project<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L154" class="link">Source</a>
<a href="#IteratorAsync_1_SelectMany_2" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Monad bind</p>
</div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
IteratorAsync<span class='generics'>&lt;</span>B<span class='generics'>&gt;</span>
<a id="IteratorAsync_1_Apply_1" class="def">Apply</a>
<span class='generics'>&lt;</span>B<span class='generics'>&gt;</span>
<span class='parens'>(</span>IteratorAsync<span class='generics'>&lt;</span>Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>B<span class='generics'>&gt;</span><span class='generics'>&gt;</span> ff<span class='comma'>, </span>IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span> fa<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L173" class="link">Source</a>
<a href="#IteratorAsync_1_Apply_1" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Applicative apply</p>
</div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<a id="IteratorAsync_1_Concat_0" class="def">Concat</a>

<span class='parens'>(</span>IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span> other<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L192" class="link">Source</a>
<a href="#IteratorAsync_1_Concat_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Concatenate two iterators</p>
</div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
ValueTask<span class='generics'>&lt;</span>S<span class='generics'>&gt;</span>
<a id="IteratorAsync_1_Fold_1" class="def">Fold</a>
<span class='generics'>&lt;</span>S<span class='generics'>&gt;</span>
<span class='parens'>(</span>
        S state,
        Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>Func<span class='generics'>&lt;</span>S<span class='comma'>, </span>S<span class='generics'>&gt;</span><span class='generics'>&gt;</span> f<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L212" class="link">Source</a>
<a href="#IteratorAsync_1_Fold_1" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Fold the sequence while there are more items remaining</p>
</div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
ValueTask<span class='generics'>&lt;</span>S<span class='generics'>&gt;</span>
<a id="IteratorAsync_1_Fold_1" class="def">Fold</a>
<span class='generics'>&lt;</span>S<span class='generics'>&gt;</span>
<span class='parens'>(</span>        
        S state,
        Func<span class='generics'>&lt;</span>S<span class='comma'>, </span>A<span class='comma'>, </span>S<span class='generics'>&gt;</span> f<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L227" class="link">Source</a>
<a href="#IteratorAsync_1_Fold_1" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Fold the sequence while there are more items remaining</p>
</div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
ValueTask<span class='generics'>&lt;</span>S<span class='generics'>&gt;</span>
<a id="IteratorAsync_1_FoldWhile_1" class="def">FoldWhile</a>
<span class='generics'>&lt;</span>S<span class='generics'>&gt;</span>
<span class='parens'>(</span>
        S state,
        Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>Func<span class='generics'>&lt;</span>S<span class='comma'>, </span>S<span class='generics'>&gt;</span><span class='generics'>&gt;</span> f,
        Func<span class='generics'>&lt;</span><span class='parens'>(</span>S State<span class='comma'>, </span>A Value<span class='parens'>)</span><span class='comma'>, </span>bool<span class='generics'>&gt;</span> predicate<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L242" class="link">Source</a>
<a href="#IteratorAsync_1_FoldWhile_1" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Fold the sequence while the predicate returns <code>true</code> and there are more items remaining</p>
</div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
ValueTask<span class='generics'>&lt;</span>S<span class='generics'>&gt;</span>
<a id="IteratorAsync_1_FoldWhile_1" class="def">FoldWhile</a>
<span class='generics'>&lt;</span>S<span class='generics'>&gt;</span>
<span class='parens'>(</span>
        S state,
        Func<span class='generics'>&lt;</span>S<span class='comma'>, </span>A<span class='comma'>, </span>S<span class='generics'>&gt;</span> f,
        Func<span class='generics'>&lt;</span><span class='parens'>(</span>S State<span class='comma'>, </span>A Value<span class='parens'>)</span><span class='comma'>, </span>bool<span class='generics'>&gt;</span> predicate<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L259" class="link">Source</a>
<a href="#IteratorAsync_1_FoldWhile_1" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Fold the sequence while the predicate returns <code>true</code> and there are more items remaining</p>
</div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
ValueTask<span class='generics'>&lt;</span>S<span class='generics'>&gt;</span>
<a id="IteratorAsync_1_FoldUntil_1" class="def">FoldUntil</a>
<span class='generics'>&lt;</span>S<span class='generics'>&gt;</span>
<span class='parens'>(</span>
        S state,
        Func<span class='generics'>&lt;</span>A<span class='comma'>, </span>Func<span class='generics'>&lt;</span>S<span class='comma'>, </span>S<span class='generics'>&gt;</span><span class='generics'>&gt;</span> f,
        Func<span class='generics'>&lt;</span><span class='parens'>(</span>S State<span class='comma'>, </span>A Value<span class='parens'>)</span><span class='comma'>, </span>bool<span class='generics'>&gt;</span> predicate<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L276" class="link">Source</a>
<a href="#IteratorAsync_1_FoldUntil_1" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Fold the sequence until the predicate returns <code>true</code> or the sequence ends</p>
</div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
ValueTask<span class='generics'>&lt;</span>S<span class='generics'>&gt;</span>
<a id="IteratorAsync_1_FoldUntil_1" class="def">FoldUntil</a>
<span class='generics'>&lt;</span>S<span class='generics'>&gt;</span>
<span class='parens'>(</span>
        S state,
        Func<span class='generics'>&lt;</span>S<span class='comma'>, </span>A<span class='comma'>, </span>S<span class='generics'>&gt;</span> f,
        Func<span class='generics'>&lt;</span><span class='parens'>(</span>S State<span class='comma'>, </span>A Value<span class='parens'>)</span><span class='comma'>, </span>bool<span class='generics'>&gt;</span> predicate<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L293" class="link">Source</a>
<a href="#IteratorAsync_1_FoldUntil_1" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Fold the sequence until the predicate returns <code>true</code> or the sequence ends</p>
</div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<a id="IteratorAsync_1_Merge_0" class="def">Merge</a>

<span class='parens'>(</span>IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span> other<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L314" class="link">Source</a>
<a href="#IteratorAsync_1_Merge_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Interleave two iterator sequences together</p>
</div>
<div><p>Whilst there are items in both sequences, each is yielded after the other.  Once one sequence
runs out of items, the remaining items of the other sequence is yielded alone.</p>
</div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
IteratorAsync<span class='generics'>&lt;</span>(A First <span class='comma'>, </span>A Second)<span class='generics'>&gt;</span>
<a id="IteratorAsync_1_Zip_0" class="def">Zip</a>

<span class='parens'>(</span>IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span> other<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L359" class="link">Source</a>
<a href="#IteratorAsync_1_Zip_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Zips the items of two sequences together</p>
</div>
<div><p>The output sequence will be as long as the shortest input sequence.</p>
</div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
ValueTask
<a id="IteratorAsync_1_DisposeAsync_0" class="def">DisposeAsync</a>

<span class='parens'>(</span><span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L386" class="link">Source</a>
<a href="#IteratorAsync_1_DisposeAsync_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Dispose</p>
</div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
IAsyncEnumerator<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<a id="IteratorAsync_1_GetAsyncEnumerator_0" class="def">GetAsyncEnumerator</a>

<span class='parens'>(</span>CancellationToken token<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L883" class="link">Source</a>
<a href="#IteratorAsync_1_GetAsyncEnumerator_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Get enumerator</p>
</div>
<div></div>
<div class="methods"><p class="caption">Parameters</p>
<div class="params-and-returns"><table><tbody><tr><td class="src clearfix"><span class="keyword">returns</span></td>
<td colspan="2" class="src clearfix"><span class="instruction inst-left"></span></td></tr></tbody></table></div></div>
</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
string
<a id="IteratorAsync_1_ToString_0" class="def">ToString</a>

<span class='parens'>(</span><span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L887" class="link">Source</a>
<a href="#IteratorAsync_1_ToString_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div></div>
<div></div>

</div>












</div></div>
<div class="subs methods"><p class="caption">Operators</p>
<div class="top"><p class="src"><span class="keyword">operator</span>
<a id="IteratorAsync_1_+_0" class="def">+</a>
<span class='parens'>(</span>IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span> ma<span class='comma'>, </span>IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span> mb<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L380" class="link">Source</a>
<a href="#IteratorAsync_1_+_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Combine two sequences</p>
</div>
<div></div>

</div>












</div></div>



</div>
<div class="top"><p class="src"><span class="keyword">class</span>
<a id="IteratorAsync_1_Nil_0" class="def">Nil</a>

<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L393" class="link">Source</a>
<a href="#IteratorAsync_1_Nil_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Nil iterator case</p>
<p>The end of the sequence.</p>
</div>
<div></div>

</div>



<div class="subs methods"><p class="caption">Fields</p>
<div class="top"><p class="src"><span class="keyword">field</span>
IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<a id="Nil_0_Default = new Nil()_0" class="def">Default = new Nil()</a>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L395" class="link">Source</a>
<a href="#Nil_0_Default = new Nil()_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div></div>
<div></div>

</div>












</div></div>

<div class="subs methods"><p class="caption">Properties</p>
<div class="top"><p class="src"><span class="keyword">property</span>
ValueTask<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<a id="Nil_0_Head_0" class="def">Head</a>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L400" class="link">Source</a>
<a href="#Nil_0_Head_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Head element</p>
</div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">property</span>
ValueTask<span class='generics'>&lt;</span>IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span><span class='generics'>&gt;</span>
<a id="Nil_0_Tail_0" class="def">Tail</a>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L406" class="link">Source</a>
<a href="#Nil_0_Tail_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Tail of the sequence</p>
</div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">property</span>
ValueTask<span class='generics'>&lt;</span>bool<span class='generics'>&gt;</span>
<a id="Nil_0_IsEmpty_0" class="def">IsEmpty</a>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L412" class="link">Source</a>
<a href="#Nil_0_IsEmpty_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Return true if there are no elements in the sequence.</p>
</div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">property</span>
ValueTask<span class='generics'>&lt;</span>long<span class='generics'>&gt;</span>
<a id="Nil_0_Count_0" class="def">Count</a>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L438" class="link">Source</a>
<a href="#Nil_0_Count_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Return the number of items in the sequence.</p>
</div>
<div><p>Requires all items to be evaluated, this will happen only once however.</p>
</div>

</div>












</div></div>

<div class="subs methods"><p class="caption">Methods</p>
<div class="top"><p class="src"><span class="keyword">method</span>
IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<a id="Nil_0_Clone_0" class="def">Clone</a>

<span class='parens'>(</span><span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L419" class="link">Source</a>
<a href="#Nil_0_Clone_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Clone the iterator so that we can consume it without having the head item referenced.
This will stop any GC pressure.</p>
</div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<a id="Nil_0_Split_0" class="def">Split</a>

<span class='parens'>(</span><span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L429" class="link">Source</a>
<a href="#Nil_0_Split_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>When iterating a sequence, it is possible (before evaluation of the <code>Tail</code>) to Terminate the current
iterator and to take a new iterator that continues on from the current location.  The reasons for doing
this are to break the linked-list chain so that there isn't a big linked-list of objects in memory that
can't be garbage collected.</p>
</div>
<div></div>
<div class="methods"><p class="caption">Parameters</p>
<div class="params-and-returns"><table><tbody><tr><td class="src clearfix"><span class="keyword">returns</span></td>
<td colspan="2" class="src clearfix"><span class="instruction inst-left"><p>New iterator that starts from the current iterator position</p>
</span></td></tr></tbody></table></div></div>
</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
ValueTask
<a id="Nil_0_DisposeAsync_0" class="def">DisposeAsync</a>

<span class='parens'>(</span><span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L442" class="link">Source</a>
<a href="#Nil_0_DisposeAsync_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div></div>
<div></div>

</div>












</div></div>




</div>
<div class="top"><p class="src"><span class="keyword">class</span>
<a id="IteratorAsync_1_Cons_0" class="def">Cons</a>

<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L451" class="link">Source</a>
<a href="#IteratorAsync_1_Cons_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Cons iterator case.</p>
<p>Contains a head value and a tail that represents the rest of the sequence.</p>
</div>
<div></div>

</div>







<div class="subs methods"><p class="caption">Methods</p>
<div class="top"><p class="src"><span class="keyword">method</span>
void
<a id="Cons_0_Deconstruct_0" class="def">Deconstruct</a>

<span class='parens'>(</span>out ValueTask<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span> head<span class='comma'>, </span>out ValueTask<span class='generics'>&lt;</span>IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span><span class='generics'>&gt;</span> tail<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.cs#L453" class="link">Source</a>
<a href="#Cons_0_Deconstruct_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div></div>
<div></div>

</div>












</div></div>




</div>
<div class="top"><p class="src"><span class="keyword">class</span>
<a id="_0_IteratorAsyncExtensions_0" class="def">IteratorAsyncExtensions</a>

<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.Extensions.cs#L6" class="link">Source</a>
<a href="#_0_IteratorAsyncExtensions_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div></div>
<div></div>

</div>







<div class="subs methods"><p class="caption">Methods</p>
<div class="top"><p class="src"><span class="keyword">method</span>
IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<a id="IteratorAsyncExtensions_0_As_1" class="def">As</a>
<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<span class='parens'>(</span>this K<span class='generics'>&lt;</span>IteratorAsync<span class='comma'>, </span>A<span class='generics'>&gt;</span> ma<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.Extensions.cs#L11" class="link">Source</a>
<a href="#IteratorAsyncExtensions_0_As_1" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Downcast operator</p>
</div>
<div></div>

</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<a id="IteratorAsyncExtensions_0_GetIteratorAsync_1" class="def">GetIteratorAsync</a>
<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<span class='parens'>(</span>this IAsyncEnumerable<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span> enumerable<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.Extensions.cs#L17" class="link">Source</a>
<a href="#IteratorAsyncExtensions_0_GetIteratorAsync_1" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Get an iterator for any <code>IAsyncEnumerable</code></p>
</div>
<div></div>

</div>












</div></div>




</div>
<div class="top"><p class="src"><span class="keyword">class</span>
<a id="_0_IteratorAsync_0" class="def">IteratorAsync</a>

<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.Module.cs#L6" class="link">Source</a>
<a href="#_0_IteratorAsync_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div></div>
<div></div>

</div>







<div class="subs methods"><p class="caption">Methods</p>
<div class="top"><p class="src"><span class="keyword">method</span>
IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<a id="IteratorAsync_0_from_1" class="def">from</a>
<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<span class='parens'>(</span>IAsyncEnumerable<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span> enumerable<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.Module.cs#L14" class="link">Source</a>
<a href="#IteratorAsync_0_from_1" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Create an iterator from an <code>IAsyncEnumerable</code></p>
</div>
<div></div>
<div class="methods"><p class="caption">Parameters</p>
<div class="params-and-returns"><table><tbody><tr><td class="src clearfix"><span class="keyword">type</span></td>
<td class="src clearfix"><span class="inst-left"><span class="def">A</span></span></td>
<td class="src clearfix"><span class="instruction inst-left"></span></td></tr>
<tr><td class="src clearfix"><span class="keyword">param</span></td>
<td class="src clearfix"><span class="inst-left"><span class="def">enumerable</span></span></td>
<td class="src clearfix"><span class="instruction inst-left"></span></td></tr>
<tr><td class="src clearfix"><span class="keyword">returns</span></td>
<td colspan="2" class="src clearfix"><span class="instruction inst-left"></span></td></tr></tbody></table></div></div>
</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<a id="IteratorAsync_0_singleton_1" class="def">singleton</a>
<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<span class='parens'>(</span>A head<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.Module.cs#L23" class="link">Source</a>
<a href="#IteratorAsync_0_singleton_1" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Construct a singleton sequence</p>
</div>
<div></div>
<div class="methods"><p class="caption">Parameters</p>
<div class="params-and-returns"><table><tbody><tr><td class="src clearfix"><span class="keyword">type</span></td>
<td class="src clearfix"><span class="inst-left"><span class="def">A</span></span></td>
<td class="src clearfix"><span class="instruction inst-left"><p>Bound value type</p>
</span></td></tr>
<tr><td class="src clearfix"><span class="keyword">param</span></td>
<td class="src clearfix"><span class="inst-left"><span class="def">head</span></span></td>
<td class="src clearfix"><span class="instruction inst-left"><p>Head item</p>
</span></td></tr>
<tr><td class="src clearfix"><span class="keyword">returns</span></td>
<td colspan="2" class="src clearfix"><span class="instruction inst-left"><p>IteratorAsync</p>
</span></td></tr></tbody></table></div></div>
</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<a id="IteratorAsync_0_Cons_1" class="def">Cons</a>
<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<span class='parens'>(</span>A head<span class='comma'>, </span>IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span> tail<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.Module.cs#L33" class="link">Source</a>
<a href="#IteratorAsync_0_Cons_1" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Construct a sequence from a head item and a tail sequence</p>
</div>
<div></div>
<div class="methods"><p class="caption">Parameters</p>
<div class="params-and-returns"><table><tbody><tr><td class="src clearfix"><span class="keyword">type</span></td>
<td class="src clearfix"><span class="inst-left"><span class="def">A</span></span></td>
<td class="src clearfix"><span class="instruction inst-left"><p>Bound value type</p>
</span></td></tr>
<tr><td class="src clearfix"><span class="keyword">param</span></td>
<td class="src clearfix"><span class="inst-left"><span class="def">head</span></span></td>
<td class="src clearfix"><span class="instruction inst-left"><p>Head item</p>
</span></td></tr>
<tr><td class="src clearfix"><span class="keyword">param</span></td>
<td class="src clearfix"><span class="inst-left"><span class="def">tail</span></span></td>
<td class="src clearfix"><span class="instruction inst-left"><p>Tail sequences</p>
</span></td></tr>
<tr><td class="src clearfix"><span class="keyword">returns</span></td>
<td colspan="2" class="src clearfix"><span class="instruction inst-left"><p>IteratorAsync</p>
</span></td></tr></tbody></table></div></div>
</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<a id="IteratorAsync_0_Cons_1" class="def">Cons</a>
<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<span class='parens'>(</span>A head<span class='comma'>, </span>Func<span class='generics'>&lt;</span>IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span><span class='generics'>&gt;</span> tail<span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.Module.cs#L43" class="link">Source</a>
<a href="#IteratorAsync_0_Cons_1" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Construct a sequence from a head item and a tail sequence</p>
</div>
<div></div>
<div class="methods"><p class="caption">Parameters</p>
<div class="params-and-returns"><table><tbody><tr><td class="src clearfix"><span class="keyword">type</span></td>
<td class="src clearfix"><span class="inst-left"><span class="def">A</span></span></td>
<td class="src clearfix"><span class="instruction inst-left"><p>Bound value type</p>
</span></td></tr>
<tr><td class="src clearfix"><span class="keyword">param</span></td>
<td class="src clearfix"><span class="inst-left"><span class="def">head</span></span></td>
<td class="src clearfix"><span class="instruction inst-left"><p>Head item</p>
</span></td></tr>
<tr><td class="src clearfix"><span class="keyword">param</span></td>
<td class="src clearfix"><span class="inst-left"><span class="def">tail</span></span></td>
<td class="src clearfix"><span class="instruction inst-left"><p>Tail sequences</p>
</span></td></tr>
<tr><td class="src clearfix"><span class="keyword">returns</span></td>
<td colspan="2" class="src clearfix"><span class="instruction inst-left"><p>IteratorAsync</p>
</span></td></tr></tbody></table></div></div>
</div>












</div>
<div class="top"><p class="src"><span class="keyword">method</span>
IteratorAsync<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<a id="IteratorAsync_0_Nil_1" class="def">Nil</a>
<span class='generics'>&lt;</span>A<span class='generics'>&gt;</span>
<span class='parens'>(</span><span class='parens'>)</span>
<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.Module.cs#L51" class="link">Source</a>
<a href="#IteratorAsync_0_Nil_1" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div><p>Empty sequence</p>
</div>
<div></div>
<div class="methods"><p class="caption">Parameters</p>
<div class="params-and-returns"><table><tbody><tr><td class="src clearfix"><span class="keyword">type</span></td>
<td class="src clearfix"><span class="inst-left"><span class="def">A</span></span></td>
<td class="src clearfix"><span class="instruction inst-left"><p>Bound value type</p>
</span></td></tr>
<tr><td class="src clearfix"><span class="keyword">returns</span></td>
<td colspan="2" class="src clearfix"><span class="instruction inst-left"><p>IteratorAsync</p>
</span></td></tr></tbody></table></div></div>
</div>












</div></div>




</div>
<div class="top"><p class="src"><span class="keyword">class</span>
<a id="_0_IteratorAsync_0" class="def">IteratorAsync</a>

<a href="https://github.com/louthy/language-ext/tree/main/LanguageExt.Core/Immutable Collections/IteratorAsync/IteratorAsync.Monad.cs#L8" class="link">Source</a>
<a href="#_0_IteratorAsync_0" class="selflink">#</a>
<div class="constraints"></div></p>
<div class="doc"><div></div>
<div></div>

</div>












</div></div></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-core.min.js" integrity="sha512-9khQRAUBYEJDCDVP2yw3LRUQvjJ0Pjx0EShmaQjcHa6AXiOv6qHQu9lCAIR8O+/D8FtaCoJ2c0Tf9Xo7hYH01Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/autoloader/prism-autoloader.min.js" integrity="sha512-fTl/qcO1VgvKtOMApX2PdZzkziyr2stM65GYPLGuYMnuMm1z2JLJG6XVU7C/mR+E7xBUqCivykuhlzfqxXBXbg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script></body></html>